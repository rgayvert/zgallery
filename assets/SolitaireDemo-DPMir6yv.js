var M=Object.defineProperty;var N=(s,e,t)=>e in s?M(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(N(s,typeof e!="symbol"?e+"":e,t),t);import{k as f,a as l,aR as A,bN as B,aT as L,s as O,bO as x,B as k,J as G,f as D,bP as $,a9 as U,aa as E,aN as y,V as R,c as o,H as q,l as T,D as I,e as H,bQ as V,P as W,bR as z,bS as j,ac as J,m as Q,ae as Y,bT as Z,ao as K,G as X}from"./index-CwbDIC8L.js";import{t as _}from"./TimerAtom-BOEt1TFP.js";const p={stockToTalon:0,talonToFoundation:10,tableauToFoundation:10,talonToTableau:5,tableauToTableau:5,none:0},c=class c{constructor(e){a(this,"suit");a(this,"indexInSuit");a(this,"name");a(this,"pile");a(this,"faceup",l(!1,{name:`${this.toString()}-faceup`}));a(this,"imageName",l(()=>this.getImageName()));a(this,"cardID");this.index=e,this.cardID=this.getCardID(),e===0?(this.suit=0,this.name="blank",this.indexInSuit=0):(this.suit=Math.floor((e-1)/13),this.indexInSuit=(e-1)%13+1,this.name=c.names[this.indexInSuit-1])}static nextID(){return this.cardID++}frontImageName(){return`playing_card.${this.fullName}`}getImageName(){return this.faceup.get()?this.frontImageName():"playing_card.back"}getCardID(){return c.nextID()}get fullName(){return`${c.suits[this.suit]}_${this.name}`}toString(){return this.fullName}get color(){return c.suitColors[this.suit]}isFaceUp(){return this.faceup.get()}turnFaceUp(){this.faceup.set(!0)}turnFaceDown(){this.faceup.set(!1)}isOnTalonPile(){return this.pile instanceof P}isOnFoundationPile(){return this.pile instanceof C}isOnTableauPile(){return this.pile instanceof u}isLastInPile(){var e;return this===((e=this.pile)==null?void 0:e.lastCard())}indexInPile(){return this.pile?this.pile.cards.get().indexOf(this):-1}mayMoveToFoundationPile(e){const t=e.lastCard();return t instanceof d&&this.name==="ace"||t!==void 0&&this.isLastInPile()&&this.suit===t.suit&&this.indexInSuit===t.indexInSuit+1}mayMoveToTableauPile(e){const t=e.lastCard();return!!(t instanceof d&&this.name==="king"||t&&this.color!==t.color&&this.indexInSuit===t.indexInSuit-1)}isTopOfTableauSequence(){var t;const e=(t=this.pile)==null?void 0:t.cardAtIndex(this.indexInPile()-1);return this.pile instanceof u&&(e===void 0||!e.faceup.get())}isBottomOfTableauSequence(){var e;return((e=this.pile)==null?void 0:e.cardAtIndex(this.indexInPile()+1))===void 0}willAcceptCard(e){const t=this.pile;return e&&e!==this&&t instanceof u&&this.isBottomOfTableauSequence()&&e.mayMoveToTableauPile(t)||t instanceof C&&e.mayMoveToFoundationPile(t)}willAcceptDrop(){return this.pile instanceof u||this.pile instanceof C}};a(c,"suits",["clubs","diamonds","hearts","spades"]),a(c,"suitColors",["black","red","red","black"]),a(c,"names",["ace",...f.sequence(2,9).map(e=>e.toString()),"jack","queen","king"]),a(c,"cardID",0);let g=c;const m=class m extends g{static nextBaseCardID(){return this.baseCardID--}constructor(){super(0),m.allBaseCards.push(this)}getCardID(){return m.nextBaseCardID()}get fullName(){return"blank"}allowDrag(){return!1}turnFaceUp(){}getImageName(){return"playing_card.blank"}};a(m,"baseCardID",-1),a(m,"allBaseCards",[]);let d=m;class S{constructor(e,t=0){a(this,"cards");a(this,"baseCard",new d);this.name=e,this.cards=A(Array(t),{name:e})}get currentCards(){return this.cards.get()}setCards(e){e.forEach(t=>t.pile=this),this.cards.set(e.length>0&&e[0]instanceof d?e:[this.baseCard,...e])}isEmpty(){return this.currentCards.length===1}lastCard(){return this.currentCards.at(-1)}indexOfCard(e){return this.currentCards.indexOf(e)}cardAtIndex(e){return this.currentCards[e]}willAcceptCard(e){return!1}acceptCard(e){return 0}addCard(e){this.setCards([...this.currentCards,e])}removeCard(e){e&&this.setCards(this.currentCards.filter(t=>t!==e))}removeLastCard(){this.removeCard(this.lastCard())}}class F extends S{constructor(){super("stock",24)}}class P extends S{constructor(){super("talon")}createInitialCards(){return A([],{name:"talon"})}acceptCard(e){const t=e.pile;return t==null||t.removeCard(e),e.faceup.set(!0),this.addCard(e),p.stockToTalon}}class C extends S{constructor(e){super(`foundation[${e}]`),this.index=e}willAcceptCard(e){return e.mayMoveToFoundationPile(this)}acceptCard(e){const t=e.pile;return t instanceof P||t instanceof u?(t.removeLastCard(),this.addCard(e),t instanceof P?p.talonToFoundation:p.tableauToFoundation):p.none}}class u extends S{constructor(e){super(`tableau[${e}]`),this.index=e}willAcceptCard(e){return e.mayMoveToTableauPile(this)}turnLastCardFaceUp(){var e;(e=this.currentCards.at(-1))==null||e.turnFaceUp()}setCards(e){super.setCards(e),this.turnLastCardFaceUp()}removeLastCard(){super.removeLastCard(),this.turnLastCardFaceUp()}acceptCard(e){const t=e.pile;if(t instanceof P||t instanceof C)return t.removeLastCard(),this.addCard(e),p.talonToTableau;if(t instanceof u){const i=e.indexInPile(),n=t.cards.get().slice(i);return t.setCards(t.cards.get().slice(0,i)),t.turnLastCardFaceUp(),this.setCards([...this.cards.get(),...n]),p.tableauToTableau}return p.none}}function ee(s,e){function t(r){const h=$.dragData;return h instanceof g&&r.willAcceptCard(h)?"2px solid green":""}function i(){return{click:e}}function n(r){return{click:e,drag:{dragData:r,mayDrag:l(()=>r.isFaceUp()&&(r.isOnTalonPile()||r.isOnTableauPile()))},drop:{acceptsDrop:l(()=>r.willAcceptDrop()),acceptsData:h=>h instanceof g&&r.willAcceptCard(h),dataTransferEffect:"move",dropAction:h=>{var v;return(v=r.pile)==null?void 0:v.acceptCard(h)}}}}function b(r){return r instanceof d?i():n(r)}const w={id:s.cardID.toString(),name:s.fullName,model:s,height:"fit-content",position:"relative",filter:l(()=>B()?L(.7):void 0),retainOnRemove:!0,componentName:"Card",events:b(s),effects:{mounted:O.slideFromPreviousLocation("in"),dragged:x({filter:"brightness(0.75)"}),draggedOver:x({border:l(()=>t(s))})}};return k(w).append(G(s.imageName,{width:D(100)}))}class te{constructor(){a(this,"data",U.instance);a(this,"deck",f.sequence(1,52).map(e=>new g(e)));a(this,"score",l(0));a(this,"elapsedTime",_(e=>`Time: ${f.formatSeconds(e/1e3)}`,1e3));a(this,"scoreString",l(()=>`Score: ${this.score.get()}`));a(this,"highScore",this.data.addAtom("solitaireHighScore",0));a(this,"highScoreString",l(()=>`High Score: ${this.highScore.get()}`));a(this,"lowTime",this.data.addAtom("solitaireLowTime",0));a(this,"lowTimeString",l(()=>`Best Time: ${f.formatSeconds(this.lowTime.get())}`));a(this,"stockPile",new F);a(this,"talonPile",new P);a(this,"foundationPiles",f.sequence(0,4).map(e=>new C(e)));a(this,"tableauPiles",f.sequence(0,7).map(e=>new u(e)))}newGame(){this.deal(),this.score.set(0),this.elapsedTime.stop()}addToScore(e){E(this.score,e),this.score.get()>this.highScore.get()&&this.highScore.set(this.score.get())}stopClock(){this.elapsedTime.stop();const e=Math.floor(this.elapsedTime.elapsedMilliseconds()/1e3),t=this.lowTime.get();(t===0||e<t)&&this.lowTime.set(e)}gameIsWon(){return!this.deck.find(e=>!e.isFaceUp())&&this.talonPile.isEmpty()}deal(){this.deck.forEach(t=>t.turnFaceDown()),f.shuffle(this.deck),this.stockPile.setCards(this.deck.slice(0,24)),this.talonPile.setCards([]);for(let t=0;t<4;t++)this.foundationPiles[t].setCards([]);for(let t=0;t<7;t++)this.tableauPiles[t].setCards([]);let e=24;for(let t=0;t<7;t++)this.tableauPiles[t].setCards(this.deck.slice(e,e+t+1)),e+=t+1}findDestinationPileForCard(e){const t=e.pile;if(t instanceof F)return this.talonPile;if(e.faceup.get()){if(e.name==="ace")return this.foundationPiles.find(i=>i.willAcceptCard(e));if(e.name==="2")return this.foundationPiles.find(i=>i.willAcceptCard(e))||this.tableauPiles.find(i=>i.willAcceptCard(e));if(t instanceof P)return this.tableauPiles.find(i=>i.willAcceptCard(e))||this.foundationPiles.find(i=>i.willAcceptCard(e));if(t instanceof u)return this.foundationPiles.find(i=>i.willAcceptCard(e))||this.tableauPiles.find(i=>i.willAcceptCard(e));if(t instanceof C)return this.tableauPiles.find(i=>i.willAcceptCard(e))}}turnTopStockCard(){this.startTimerIfNotRunning();const e=this.stockPile.cards.get();if(e.length>1){const t=e[e.length-1];this.talonPile.acceptCard(t)}else this.flipTalonPile()}flipTalonPile(){const e=y(this.talonPile.cards).slice(1).reverse();e.forEach(t=>t.turnFaceDown()),this.stockPile.setCards(e),this.talonPile.setCards([])}cardMayBeMoved(e){const t=!!this.foundationPiles.find(n=>n.willAcceptCard(e)),i=!!this.tableauPiles.find(n=>n.willAcceptCard(e));return e.faceup&&(e instanceof d&&e.pile===this.stockPile||e.pile===this.stockPile||t||i)}startTimerIfNotRunning(){this.elapsedTime.isRunning()||this.elapsedTime.start()}cardClicked(e){if(!this.gameIsWon()){if(this.startTimerIfNotRunning(),e instanceof d&&e.pile===this.stockPile)this.flipTalonPile();else{const t=this.findDestinationPileForCard(e);t&&(this.addToScore(t.acceptCard(e)),this.stockPile.isEmpty()&&this.talonPile.isEmpty()&&!this.deck.find(i=>!i.isFaceUp())&&this.autoPlay())}this.gameIsWon()&&this.stopClock()}}autoPlay(){const[e,t]=this.findMovableCard();e&&(this.addToScore(t.acceptCard(e)),setTimeout(()=>{this.autoPlay()},100))}findMovableCard(){for(const e of this.tableauPiles){const t=e.lastCard();if(t){const i=this.foundationPiles.find(n=>n.willAcceptCard(t));if(i)return[t,i]}}return[void 0,void 0]}}function ie(s){return R({padding:o.space.s3,alignItems:"center"}).append(q({padding:o.space.s3}).append(T(s.highScoreString,{font:o.font.title_medium}),I(o.space.s4),T(s.lowTimeString,{font:o.font.title_medium}),I(o.space.s6),T(s.scoreString,{font:o.font.title_medium}),I(o.space.s4),T(s.elapsedTime,{font:o.font.title_medium}),k({width:H(3)}),V("New Game",{padding:o.space.s0,font:o.font.title_medium,action:()=>s.newGame()})))}function se(s){const e=new Map([...d.allBaseCards,...s.deck].map(i=>[i.cardID,ee(i,()=>s.cardClicked(i))]));function t(i,n,b="0"){const w=l(()=>y(i.cards).map(r=>e.get(r.cardID)));return z({name:n,offsetY:b,hasBaseView:!0,padding:o.space.s0,font:o.font.display_medium}).append(j(w))}return W({gap:o.space.s2,templateRows:"1fr 4fr",ncolumns:7,width:D(100),aspectRatio:6/5}).append(t(s.stockPile,"stock"),t(s.talonPile,"talon"),k({name:"filler"}),...s.foundationPiles.map((i,n)=>t(i,`foundation_${n}`)),...s.tableauPiles.map((i,n)=>t(i,`tableau_${n}`,"5%")))}J("SolitaireGame","Box",{width:D(100),maxWidth:Q(100),outline:o.border.none,onIntersectionVisible:s=>s.focus(!0)});function ae(s={}){const e=Y("SolitaireGame",s),t=new te;return Z(e,{keyBindings:{Space:()=>t.turnTopStockCard()}}),t.deal(),K(e).append(ie(t),se(t))}function ce(){return X(ne)}const ne={sourceDir:"/source/Demos/Solitaire",sections:[{title:"Solitaire",componentFn:ae,sources:["SolitaireModel.ts","SolitaireGame.ts","SolitaireHeader.ts","SolitaireGrid.ts","PlayingCard.ts"],markdown:"SolitaireGame.md"}]};export{ce as SolitaireDemo,ce as default};
