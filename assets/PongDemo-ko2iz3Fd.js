var P=Object.defineProperty;var v=(e,l,t)=>l in e?P(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t;var o=(e,l,t)=>(v(e,typeof l!="symbol"?l+"":l,t),t);import{a as n,ad as d,g as w,k as g,v as f,aa as b,V as S,f as m,m as V,c,h as B,B as M,af as k,bm as u,aQ as A,p as D,bq as O,G}from"./index-wYdoKrg9.js";import{S as x,A as I}from"./BasicAnimator-DRXMr5Lm.js";class z extends x{constructor(){super(...arguments);o(this,"rect",n(()=>d(this.location.get().x,this.location.get().y,16,16)))}}class y extends x{constructor(t,r,i){super(w(t,200));o(this,"autoplay");o(this,"rect",n(()=>d(this.x,this.location.get().y,16,80)));this.x=t,this.ball=r,this.userPaddleY=i,this.autoplay=!i}step(t,r){var p;super.step(t,r);let i;const s=this.ball.location.get(),a=this.ball.velocity.get();if(this.autoplay)if(a.x>0)i=240;else{const h=s.y-s.x*a.y/a.x;i=h<0||h>440?240:h}else i=(p=this.userPaddleY)==null?void 0:p.get();if(i){const h=g.clamp(i,20,460)-this.rect.get().center.y;this.velocity.set(f(0,g.clamp(h*.01,-.5,.5)))}}}class Y extends I{constructor(){super();o(this,"blocks",g.sequence(0,15).map(t=>d(312,t*32+8,16,16)));o(this,"startingVelocity",f(.3,0));o(this,"ball",new z(g.randomElement(this.blocks).origin,this.startingVelocity));o(this,"userPaddleY",n(200));o(this,"paddles",[new y(24,this.ball),new y(616,this.ball,this.userPaddleY)]);o(this,"scores",g.sequence(0,2).map(t=>n(0)));o(this,"gameOver",n(()=>this.scores[0].get()===10||this.scores[1].get()===10,{action:t=>t&&this.stop()}));this.setItems([this.ball,...this.paddles]),this.ball.location.addAction(()=>this.ballMoved())}start(){super.start(),this.scores.forEach(t=>t.set(0))}initializeBall(){this.ball.location.set(g.randomElement(this.blocks).origin),this.startingVelocity=this.startingVelocity.scalarMultiply(-1),this.ball.velocity.set(this.startingVelocity)}ballMoved(){const t=this.ball.rect.get();t.intersects(this.paddles[0].rect.get())?this.bounceOffPaddle(this.paddles[0],!0,t):t.intersects(this.paddles[1].rect.get())?this.bounceOffPaddle(this.paddles[1],!1,t):t.top<0||t.bottom>480?this.bounceOffWall():t.left<0?(b(this.scores[1]),this.initializeBall()):t.right>640&&(b(this.scores[0]),this.initializeBall())}bounceOffWall(){const t=this.ball.velocity.get();this.ball.velocity.set(f(t.x,-t.y))}bounceOffPaddle(t,r,i){const s=(t.rect.get().center.y-i.center.y)/t.rect.get().height,a=Math.PI*.7,p=this.ball.velocity.get(),h=r?-s*a:Math.PI+s*a;this.ball.velocity.set(p.withAngle(h))}}function E(){const e=new Y;function l(){return u({rect:d(0,0,16,16),fill:c.color.red,transform:n(()=>`translate(${e.ball.location.get().x}px, ${e.ball.rect.get().y}px`)})}function t(s){return u({rect:s.rect.get().translateToOrigin(),fill:c.color.blue,transform:n(()=>`translate(${s.rect.get().x}px, ${s.rect.get().y}px`)})}function r(s,a){return A(s,{x:a===0?270:370,y:64,fontSize:D(64),textAnchor:"middle",fill:c.color.white})}function i(){return u({x:0,y:0,width:640,height:480,fill:c.color.black,events:{pointerMove:s=>e.userPaddleY.set(O(s).y)}})}return S({width:m(100),maxWidth:V(120),gap:c.space.s4}).append(B({label:n(()=>e.isRunning?"Stop":"Start"),action:()=>e.isRunning?e.stop():e.start()}),M({width:m(90),padding:c.space.s4,background:c.color.gray}).append(k({width:m(100),bounds:d(0,0,640,480)}).append(i(),...e.blocks.map(s=>u({rect:s,fill:c.color.white})),...e.scores.map((s,a)=>r(n(()=>s.get().toString()),a)),l(),...e.paddles.map(s=>t(s)))))}function F(){return G(R)}const R={sourceDir:"/source/Demos/Pong",sections:[{title:"Pong",componentFn:E,sources:["PongItems.ts","PongModel.ts","Pong.ts"],markdown:"Pong.md"}]};export{F as PongDemo,F as default};
