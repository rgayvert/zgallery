var z=Object.defineProperty;var w=(s,a,t)=>a in s?z(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var r=(s,a,t)=>(w(s,typeof a!="symbol"?a+"":a,t),t);import{v as S,a as o,ad as m,g as p,aR as x,k as d,aK as k,f as g,m as y,c as l,V as P,h as D,B,af as H,aj as C,aP as M,bm as f,G as I}from"./index-CaL7Oo4K.js";import{S as v,A}from"./BasicAnimator-DieukM6C.js";class V extends v{constructor(t,e,n,i,h,c,u){super();r(this,"elapsedTime",0);r(this,"interval",150);this.bounds=t,this.blockSize=e,this.segments=n,this.direction=i,this.pellet=h,this.onHit=c,this.onCrash=u}get head(){return this.segments.at(0)}get tail(){return this.segments.at(-1)}indexOfSegment(t){return this.segments.indexOf(t)}meets(t){return!!this.segments.find(e=>t.intersects(e.rect.get()))}setDirection(t,e){const n=this.direction.get();n.x*t===0&&n.y*e===0&&this.direction.set(S(t,e))}isOverPellet(){return this.head.rect.get().origin.equals(this.pellet.get().scalarMultiply(this.blockSize))}isCrash(t){return!this.bounds.contains(t)}step(t){if(this.elapsedTime+=t,this.elapsedTime>this.interval){const e=this.tail,n=e.rect.get(),i=this.head.rect.get().translatedBy(this.direction.get().negated().scalarMultiply(this.blockSize));this.isCrash(i)?this.onCrash():(this.head.isHead.set(!1),e.rect.set(i),e.isHead.set(!0),this.segments.set([e,...this.segments.get().slice(0,-1)]),this.elapsedTime=0,this.isOverPellet()&&(this.segments.push({isHead:o(!1),rect:o(n)}),this.onHit()))}}}class R extends A{constructor(){super();r(this,"blockSize",28);r(this,"nrows",15);r(this,"ncolumns",21);r(this,"bounds",m(0,0,this.ncolumns*this.blockSize,this.nrows*this.blockSize));r(this,"initialLength",5);r(this,"snake");r(this,"pellet");r(this,"offscreenPoint",p(-100,-100));r(this,"direction",o(S(0,0)));this.pellet=o(this.offscreenPoint),this.snake=new V(this.bounds,this.blockSize,x([]),this.direction,this.pellet,()=>this.placePellet(),()=>this.onCrash()),this.setItems([this.snake])}onCrash(){this.pause()}randomize(){this.direction.set(this.randomDirection()),this.snake.segments.set(this.randomSegments(this.direction.get())),this.placePellet()}placePellet(){this.pellet.set(this.randomPelletPoint())}start(){this.randomize(),super.start()}pelletCenter(){const t=this.blockSize/2;return o(()=>p(this.pellet.get().x*this.blockSize+t,this.pellet.get().y*this.blockSize+t))}randomPointInBox(t){return p(d.randomInt(t.left,t.right),d.randomInt(t.top,t.bottom))}randomDirection(){const t=d.randomInt(-1,1),e=t===0?d.randomElement([-1,1]):0;return S(t,e)}randomPelletPoint(){let t,e;do e=this.randomPointInBox(m(0,0,this.ncolumns-1,this.nrows-1)),t=Math.min(...this.snake.segments.map(n=>n.rect.get().center.distanceTo(e)));while(t<4);return e}randomSegments(t){const e=this.initialLength+1,n=this.randomPointInBox(m(e,e,this.ncolumns-e*2,this.nrows-e*2)),h=[{isHead:o(!0),rect:o(n.scalarMultiply(this.blockSize).extent(k(this.blockSize,this.blockSize)))}];for(let c=1;c<e-1;c++){const u=t.scalarMultiply(c),b={isHead:o(!1),rect:o(n.add(u).scalarMultiply(this.blockSize).extent(k(this.blockSize,this.blockSize)))};h.push(b)}return h}turn(t,e){this.snake.setDirection(t,e)}}function T(){const s=new R;function a(i){return f({rect:m(1,1,s.blockSize-2,s.blockSize-2),rx:8,ry:8,fill:o(()=>i.isHead.get()?l.color.red:l.color.primary),transform:o(()=>`translate(${i.rect.get().x}px, ${i.rect.get().y}px`),model:i})}function t(){return M({c:s.pelletCenter(),r:s.blockSize/2,fill:l.color.tertiary})}function e(){return f({rect:s.bounds,fill:l.color.primaryContainer})}const n={width:g(90),maxWidth:y(100),padding:l.space.s4,background:l.color.gray,onIntersectionVisible:i=>i.focus(),outline:"none",events:{keyBindings:{ArrowUp:()=>s.turn(0,1),ArrowDown:()=>s.turn(0,-1),ArrowLeft:()=>s.turn(1,0),ArrowRight:()=>s.turn(-1,0)}}};return P({width:g(100),gap:l.space.s4,name:"Snake",model:s}).append(D({label:o(()=>s.isRunning?"Stop":"Start"),action:()=>s.isRunning?s.pause():s.start(),preserveFocus:!0}),B(n).append(H({width:g(100),bounds:s.bounds}).append(e(),t(),C(s.snake.segments,i=>i,i=>a(i)))))}function $(){return I(G)}const G={sourceDir:"/source/Demos/Snake",sections:[{title:"Snake",componentFn:T,sources:["SnakeBoard.ts","SnakeModel.ts","Snake.ts"],markdown:"Snake.md"}]};export{$ as SnakeDemo,$ as default};
